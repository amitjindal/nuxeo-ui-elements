<link rel="import" href="../../nuxeo-elements/nuxeo-element.html">
<link rel="import" href="../../polymer/lib/utils/debounce.html">
<link rel="import" href="../../paper-input/paper-input.html">

<!-- Part of `nuxeo-data-table` -->
<dom-module id="nuxeo-data-table-column-filter">
  <template>
    <style>
      :host {
        height: 100%;
      }
      :host([hidden]) {
        display: none;
      }
      /* ELEMENTS-1214: Align this element appearance with nuxeo-selectivity */
      paper-input {
        --paper-input-container: {
          font-size: inherit;
          margin: 12px 2px 0 2px;
        }

        --paper-input-container-input: {
          min-height: 2em;
          padding: 0 0 1px 0;
          font-size: inherit;
          font-weight: 700;
        }

        --paper-input-container-color: {
          color: var(--nuxeo-text-default, #3a3a54);
        }

        --paper-input-container-label: {
          font-size: inherit;
          color: #999;
          font-weight: 600;
          padding: 0;
        }

        --paper-input-container-underline-focus: {
          border-bottom: 1px solid black;
        }
      }
    </style>
    <paper-input no-label-float label="[[label]]" value="[[value]]" on-value-changed="_valueChanged"></paper-input>
  </template>
  <script>
    {
      class DataTableColumnFilter extends Nuxeo.Element {

        static get is() {
          return 'nuxeo-data-table-column-filter';
        }

        static get properties() {
          return {
            label: String,
            value: {
              type: String,
              notify: true,
            },
            hidden: Boolean,
          };
        }

        _valueChanged(e) {
          // store value in a variable, referring to e.detail.value inside the debounce
          // function results in weird outcomes. event object might be reused by Polymer?
          const value = e.detail.value;
          this._debouncer = Polymer.Debouncer.debounce(this._debouncer, Polymer.Async.timeOut.after(250), () => {
            this.value = value;
          });
        }

      }

      customElements.define(DataTableColumnFilter.is, DataTableColumnFilter);
      Nuxeo.DataTableColumnFilter = DataTableColumnFilter;
    }
  </script>
</dom-module>
